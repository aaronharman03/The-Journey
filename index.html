<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SocialXP</title>
    <style>
        :root { --bg: #000; --card: #121212; --accent: #0088ff; --text: #fff; --panel: #1a1a1a; --danger: #ff5555; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; padding-top: 100px; -webkit-tap-highlight-color: transparent; }
        
        #header { position: fixed; top: 0; left: 0; right: 0; background: rgba(0,0,0,0.95); backdrop-filter: blur(10px); padding: 20px; z-index: 1000; border-bottom: 1px solid #222; }
        .bar-bg { background: #222; border-radius: 4px; height: 10px; width: 100%; margin-top: 8px; overflow: hidden; }
        .bar-fill { background: var(--accent); height: 100%; width: 0%; transition: width 0.4s ease; }
        
        .card { background: var(--card); padding: 18px; border-radius: 12px; margin-bottom: 16px; border: 1px solid #222; position: relative; }
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
        .task-name { font-size: 1.2rem; font-weight: bold; color: var(--accent); margin: 0; }
        .goal-display { font-size: 0.85rem; color: #888; margin-top: 4px; font-weight: 500; }
        
        .pct-label { font-size: 0.9rem; font-weight: 800; color: #fff; text-align: right; margin-bottom: 4px; }
        .rep-container { display: flex; align-items: center; gap: 15px; margin: 15px 0; }
        .rep-counter { font-size: 2rem; font-weight: 900; min-width: 40px; text-align: center; }
        
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 2000; align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: var(--panel); width: 100%; max-width: 400px; padding: 25px; border-radius: 20px; }
        .modal input { background: #000; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 8px; width: 100%; box-sizing: border-box; margin-bottom: 10px; }
        
        .btn { border: none; border-radius: 10px; font-weight: bold; cursor: pointer; padding: 14px; }
        .btn-primary { background: var(--accent); color: #fff; width: 100%; margin-top: 10px; }
        .circle-btn { width: 45px; height: 45px; border-radius: 50%; background: #222; color: var(--accent); border: 1px solid #333; font-size: 1.5rem; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<div id="header">
    <div style="display:flex; justify-content:space-between; align-items: flex-end; margin-bottom: 5px;">
        <strong style="font-size: 0.75rem; color: #666; letter-spacing: 1px;">TOTAL SOCIAL PROGRESS</strong>
        <span id="ov-text" style="color:var(--accent); font-weight:bold; font-size: 1.5rem;">0%</span>
    </div>
    <div class="bar-bg"><div id="ov-bar" class="bar-fill"></div></div>
</div>

<div id="list"></div>
<button class="btn btn-primary" onclick="addTask()" style="background: #111; color: var(--accent); border: 1px solid #333;">+ NEW SOCIAL MISSION</button>

<div id="taskModal" class="modal">
    <div class="modal-content">
        <h3 id="modalTitle" style="margin-top:0; color: var(--accent);">Mission Settings</h3>
        <label>Mission Name</label><input type="text" id="mName" placeholder="e.g. Talk to strangers">
        <label>Current Day</label><input type="number" id="mCurrDay">
        <label>Goal Days (Duration)</label><input type="number" id="mGoalDays">
        <label>Daily Rep Goal</label><input type="number" id="mDailyGoal">
        <button class="btn btn-primary" onclick="saveTask()">SAVE MISSION</button>
        <button class="btn" onclick="closeModal()" style="background:transparent; color:#888; width:100%;">CANCEL</button>
        <button class="btn" onclick="deleteTask()" style="color:var(--danger); font-size:0.7rem; width:100%; margin-top:20px;">DELETE MISSION</button>
    </div>
</div>

<script>
    let tasks = JSON.parse(localStorage.getItem('socialTasks')) || [];
    let editIdx = null;

    function saveToLocal() {
        localStorage.setItem('socialTasks', JSON.stringify(tasks));
        render();
    }

    function addTask() {
        editIdx = tasks.length;
        tasks.push({ name: "New Mission", currDay: 0, goalDays: 30, dailyGoal: 3, currReps: 0 });
        openModal(editIdx);
    }

    function openModal(i) {
        editIdx = i;
        const t = tasks[i];
        document.getElementById('mName').value = t.name;
        document.getElementById('mCurrDay').value = t.currDay;
        document.getElementById('mGoalDays').value = t.goalDays;
        document.getElementById('mDailyGoal').value = t.dailyGoal;
        document.getElementById('taskModal').style.display = 'flex';
    }

    function saveTask() {
        tasks[editIdx].name = document.getElementById('mName').value;
        tasks[editIdx].currDay = parseInt(document.getElementById('mCurrDay').value) || 0;
        tasks[editIdx].goalDays = parseInt(document.getElementById('mGoalDays').value) || 1;
        tasks[editIdx].dailyGoal = parseInt(document.getElementById('mDailyGoal').value) || 1;
        closeModal();
    }

    function deleteTask() {
        if(confirm("End this mission?")) {
            tasks.splice(editIdx, 1);
            closeModal();
        }
    }

    function closeModal() {
        document.getElementById('taskModal').style.display = 'none';
        saveToLocal();
    }

    function adjustRep(i, amt) {
        tasks[i].currReps = Math.max(0, tasks[i].currReps + amt);
        saveToLocal();
    }

    function render() {
        const list = document.getElementById('list');
        list.innerHTML = '';
        let totalPct = 0;

        tasks.forEach((t, i) => {
            const pct = Math.min((t.currDay / t.goalDays) * 100, 100);
            totalPct += pct;
            list.innerHTML += `
                <div class="card">
                    <div class="card-header">
                        <div>
                            <h2 class="task-name">${t.name}</h2>
                            <div class="goal-display">Day ${t.currDay} of ${t.goalDays} • Goal: ${t.dailyGoal} daily</div>
                        </div>
                        <button onclick="openModal(${i})" style="background:none; border:none; color:#555; font-size:1.2rem;">⋮</button>
                    </div>
                    <div class="rep-container">
                        <button class="circle-btn" onclick="adjustRep(${i}, -1)">−</button>
                        <div class="rep-counter">${t.currReps}</div>
                        <button class="circle-btn" onclick="adjustRep(${i}, 1)">+</button>
                        <span style="color:#555; font-size:0.8rem;">TODAY'S REPS</span>
                    </div>
                    <div class="pct-label">${pct.toFixed(1)}%</div>
                    <div class="bar-bg"><div class="bar-fill" style="width:${pct}%"></div></div>
                </div>`;
        });

        const overall = tasks.length ? (totalPct / tasks.length).toFixed(1) : 0;
        document.getElementById('ov-text').innerText = overall + '%';
        document.getElementById('ov-bar').style.width = overall + '%';
    }

    render();
</script>
</body>
</html>
